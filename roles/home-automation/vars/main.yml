home_automation_role:
  directories:
    - path: "{{ hass_dir }}"
      volume:
        name: hass-config
        backup: true
    - path: "{{ hass_db_dir }}"
      volume:
        name: hass-db
  files:
    - src: roles/home-automation/files/home-assistant.log
      dest: "{{ hass_dir }}/home-assistant.log"
      force: no
  intrusion_detection:
    jails:
      - jail_name: ha
        file: hass/home-assistant.log
    filters:
      - src: roles/home-automation/templates/filter.local.j2
        dest: ha.local
  reverse_proxy:
    public_site_configs:
      - src: roles/home-automation/templates/private-reverse-proxy.j2
        name: hass-private
      - src: roles/home-automation/templates/public-reverse-proxy.j2
        name: hass-public
  docker:
    service:
      name: homeassistant
      container_name: hass
      image: ghcr.io/home-assistant/home-assistant
      volumes:
        - hass-config:/config
        - hass-db:/db
      networks:
        default: false
        internal: true
        extra:
          docker2:
      config_dir: "{{ hass_dir }}"
      backup: true
    networks:
      - name: docker2
  files_changed_by_tasks: "{{ [hass_config | default(None)] | select() }}"
