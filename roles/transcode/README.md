# Description

This role creates the configuration directory for a transcoder that will be run in a docker container.  The `handbrake`
transcoder will be used.  It's user interface can be accessed on port 5800.  The container is configured to
automatically transcode files that are placed in the media-rip output directory, and will place the output in the
transcoder output directory.

# Variables

| Variable                          | Required | Description                                                                                                                                                                                                                                                                                      | Default                                                                                  |
|:----------------------------------|:---------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------|
| transcode_dir                     | No       | The configuration directory created by this role.                                                                                                                                                                                                                                                | `{{ docker_compose_dir }}/transcode`                                                     |
| transcode_nas_dir                 | No       | A directory on the NAS that contains transcoder input and output directories.                                                                                                                                                                                                                    | `{{ nas_media_dir }}/transcode`                                                          |
| transcode_output_dir              | No       | A directory on the NAS where the output of transcodes will be placed.                                                                                                                                                                                                                            | `{{ transcode_nas_dir }}/output`                                                         |
| transcode_keep_app_running        | No       | If the `handbrake` process should be restarted if it crashes.                                                                                                                                                                                                                                    | 1 (yes)                                                                                  |
| transcode_preset                  | No       | The preset that `handbrake` will use us when automatically transcoding.                                                                                                                                                                                                                          | General/HQ 1080p30 Surround                                                              |
| transcode_keep_source_file        | No       | If the file that was transcoded should be kept after transcode completes.                                                                                                                                                                                                                        | 0 (delete the file)                                                                      |
| transcode_output_subdir           | No       | The subdirectory of `transcode_output_dir` where automatically transcoded files should be stored.                                                                                                                                                                                                | SAME_AS_SRC (uses the same subdirectory as the file was in within `transcode_input_dir`) |
| transcode_input_stability_seconds | No       | How long, in seconds, the transcoder will wait before it begins transcoding a file found in `transcode_input_dir`.  If the file changes within this time, the time to wait will reset.  This allows the transcoder to ensure that the file has been completely written before transcoding begins | 30                                                                                       |
| transcode_input_check_seconds     | No       | How often, in seconds, the transcoder checks `transcoder_input_dir`. for new files.                                                                                                                                                                                                              | 60                                                                                       |
| transcode_config_volume           | No       | The name of the volume storing `handbrake` configuration.                                                                                                                                                                                                                                        | transcode_config                                                                         |
| transcode_destination_volume      | No       | The name of the volume in which transcoded media will be stored.                                                                                                                                                                                                                                 | transcode_destination                                                                    |
| transcode_service_name            | No       | The name of the docker-compose service running the transcoder.                                                                                                                                                                                                                                   | handbrake                                                                                |
| transcode_port                    | No       | The port on which the transcoder's web UI will be available.                                                                                                                                                                                                                                     | 5800                                                                                     |

# Parameters

| Parameter                  | Member | Description                                                             |
|:---------------------------|:-------|:------------------------------------------------------------------------|
| transcode_src_volume       |        | The volume that the transcoder will watch for new media.                |
| transcode_media_mountpoint |        | The NAS mountpoint where media files are stored.                        |

# Docker Volumes

| Volume                | Description                                                                           |
|:----------------------|:--------------------------------------------------------------------------------------|
 | transcode_destination | Directory that is used to store files that are created by the `handbrake` transcoder. |
